
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installation &#8212; NXRefine 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Experiment Configuration" href="experiment.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="experiment.html" title="Experiment Configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NXRefine 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>Currently, <em>NXRefine</em> must be installed from source by cloning the
<a class="reference external" href="https://github.com/nexpy/nxrefine">NXRefine Git repository</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/nexpy/nxrefine.git
</pre></div>
</div>
<p>Then use standard Python tools to build and/or install a distribution
from within the source directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m build  # build a distribution
$ python -m pip install .  # install the package
</pre></div>
</div>
<p>In the near future, <em>NXRefine</em> will be uploaded to the PyPI server so
that it can be installed without downloading the source code.</p>
<div class="section" id="required-libraries">
<h2>Required Libraries<a class="headerlink" href="#required-libraries" title="Permalink to this headline">¶</a></h2>
<p>The following packages are listed as dependencies.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Library</p></th>
<th class="head"><p>URL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NeXpy</p></td>
<td><p><a class="reference external" href="https://github.com/nexpy/nexpy/">https://github.com/nexpy/nexpy/</a></p></td>
</tr>
<tr class="row-odd"><td><p>nexusformat</p></td>
<td><p><a class="reference external" href="https://github.com/nexpy/nexusformat/">https://github.com/nexpy/nexusformat/</a></p></td>
</tr>
<tr class="row-even"><td><p>cctbx-base</p></td>
<td><p><a class="reference external" href="https://cci.lbl.gov/cctbx_docs/">https://cci.lbl.gov/cctbx_docs/</a></p></td>
</tr>
<tr class="row-odd"><td><p>pyfai</p></td>
<td><p><a class="reference external" href="https://pyfai.readthedocs.io/">https://pyfai.readthedocs.io/</a></p></td>
</tr>
<tr class="row-even"><td><p>sqlalchemy</p></td>
<td><p><a class="reference external" href="https://docs.sqlalchemy.org/">https://docs.sqlalchemy.org/</a></p></td>
</tr>
<tr class="row-odd"><td><p>psutil</p></td>
<td><p><a class="reference external" href="https://psutil.readthedocs.io/">https://psutil.readthedocs.io/</a></p></td>
</tr>
<tr class="row-even"><td><p>persist-queue</p></td>
<td><p><a class="reference external" href="https://github.com/peter-wangxu/persist-queue">https://github.com/peter-wangxu/persist-queue</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="nexpy">
<h2>NeXpy<a class="headerlink" href="#nexpy" title="Permalink to this headline">¶</a></h2>
<p>Although much of the <em>NXRefine</em> workflow can be performed using
command-line scripts, it is recommended that they are used in
conjunction with the Python-based GUI, <a class="reference external" href="https://nexpy.github.io/nexpy">NeXpy</a>. Once NXRefine has been installed,
<em>NeXpy</em> will automatically import a set of plugins that add three menu
items to the <em>NeXpy</em> menu bar.</p>
<div class="figure align-center" style="width: 100%">
<a class="reference internal image-reference" href="_images/NeXpy-GUI.png"><img alt="_images/NeXpy-GUI.png" src="_images/NeXpy-GUI.png" style="width: 90%;" /></a>
</div>
<ul>
<li><p><strong>Experiment</strong></p>
<p>Dialogs to set up experiment directories, initialize NeXus templates,
perform powder calibrations, create NeXus files for linking to the
scans and storing data reduction results, and, if necessary, import
existing scan data.</p>
</li>
<li><p><strong>Refine</strong></p>
<p>Dialogs to define data reduction parameters, perform peak searches,
refine crystal orientations, and prepare the reciprocal space grids
for the transformed data.</p>
</li>
<li><p><strong>Server</strong></p>
<p>Dialogs to manage workflow operations on existing data, view server
logs, and edit default settings for future experiments.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the <em>NXRefine</em> menu items do not appear in the menu bar,
check the NeXpy log file (“Show Log File” in the Window menu)
for any error messages preventing the plugin from being
loaded.</p>
</div>
<p>The menus will be described in more detail in subsequent sections.</p>
</div>
<div class="section" id="cctw">
<h2>CCTW<a class="headerlink" href="#cctw" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://sourceforge.net/projects/cctw/">CCTW</a> (Crystal Coordination
Transformation Workflow) is a C++ package written by Guy Jennings. It
is launched as a separate process by <em>NXRefine</em>, which uses the
experimental metadata to define the settings file used to define the
input and output grids. It has to be separately installed.</p>
</div>
<div class="section" id="initial-setup">
<h2>Initial Setup<a class="headerlink" href="#initial-setup" title="Permalink to this headline">¶</a></h2>
<p>In order to allow <em>NXRefine</em> to be used by multiple users on a single
machine or cluster, a common directory is defined to store log files,
task queues, and default settings. The location of this directory should
be defined immediately after installing <em>NXRefine</em> for the first time.
Since the files in this directory are modified by <em>NXRefine</em> commands
that could be run by multiple users, it is recommended that all such
users are members of the same group. When initialized by a member of
that group, the files in the server directory have group read/write
permissions by default.</p>
<p>The location of the server directory is initialized on the command line
by the ‘nxserver’ command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nxserver -d /path/to/parent
</pre></div>
</div>
<p>This will create a directory at <code class="docutils literal notranslate"><span class="pre">/path/to/parent/nxserver</span></code> containing
the files that are required by <em>NXRefine</em> server.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the supplied path already ends in <code class="docutils literal notranslate"><span class="pre">nxserver</span></code>, it will not
be appended.</p>
</div>
<p>Once the server directory has been initialized, it is necessary for its
location to be defined for other users. This can be done in one of two
ways.</p>
<ol class="arabic">
<li><p>If <em>NXRefine</em> is being configured by a system administrator, it is
possible to use a system-wide environment variable, <code class="docutils literal notranslate"><span class="pre">NX_SERVER</span></code>, to
to define the path to the server directory. Alternatively, this
environment variable could be added to each user’s login script.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">nxserver</span></code> command used to initialize the server directory also
adds a hidden file to the user’s home directory,
<code class="docutils literal notranslate"><span class="pre">~/.nxserver/settings.ini</span></code>, which contains the server directory
path. If the server directory already exists, the command can be run
again by other users without affecting the initial directory. In
principle, it only needs to be run once by each user, although it
could also be added to a login script if preferred.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">NX_SERVER</span></code> environment variable is defined, it
takes precedence over the path in
<code class="docutils literal notranslate"><span class="pre">~/.nxserver/settings.ini</span></code>.</p>
</div>
</li>
</ol>
<p><em>NXRefine</em> uses file-based locking to prevent corruption of data files.
This system is provided by the
<a class="reference external" href="https://nexpy.github.io/nexpy/">nexusformat package</a>, which defines
the directory to contain the lock files using the <code class="docutils literal notranslate"><span class="pre">NX_LOCKDIRECTORY</span></code>
environment variable. It is recommended that this directory be placed
within the server directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <em>NeXpy</em> GUI has a settings file that can be used to define
the lock directory, but it is overridden by the environment
variable if it is defined. This allows system administrators
to set up a unique lock file directory for all their users.</p>
</div>
<div class="section" id="user-support">
<h3>User Support<a class="headerlink" href="#user-support" title="Permalink to this headline">¶</a></h3>
<p>If you are interested in using this package, please contact Ray Osborn
(<a class="reference external" href="mailto:ROsborn&#37;&#52;&#48;anl&#46;gov">ROsborn<span>&#64;</span>anl<span>&#46;</span>gov</a>). Please report any bugs as a
<a class="reference external" href="https://github.com/nexpy/nxrefine/issues">Github issue</a>, with
relevant tracebacks.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#required-libraries">Required Libraries</a></li>
<li><a class="reference internal" href="#nexpy">NeXpy</a></li>
<li><a class="reference internal" href="#cctw">CCTW</a></li>
<li><a class="reference internal" href="#initial-setup">Initial Setup</a><ul>
<li><a class="reference internal" href="#user-support">User Support</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="introduction.html"
                          title="previous chapter">Introduction</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="experiment.html"
                          title="next chapter">Experiment Configuration</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/installation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="experiment.html" title="Experiment Configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NXRefine 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Ray Osborn.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>