
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Server Management &#8212; NXRefine 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Glossary of Terms" href="glossary.html" />
    <link rel="prev" title="Data Reduction" href="reduction.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="glossary.html" title="Glossary of Terms"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="reduction.html" title="Data Reduction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NXRefine 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Server Management</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="server-management">
<h1>Server Management<a class="headerlink" href="#server-management" title="Permalink to this headline">¶</a></h1>
<p><em>NXRefine</em> implements a data reduction workflow, which can be run as a
series of line commands in the terminal. However, since some of the
processes can take a long time to complete (from a few minutes to an
hour, depending on the process and system being used), it is possible to
queue these operations using the <em>NXRefine</em>’s queue manager, to be run
locally using multiple cores or distributed to other nodes. The
<em>NXRefine</em> queue manager can be configured to submit jobs to another job
queue manager if one is available.</p>
<div class="section" id="server-directory">
<h2>Server Directory<a class="headerlink" href="#server-directory" title="Permalink to this headline">¶</a></h2>
<p>Here is the structure of the <code class="docutils literal notranslate"><span class="pre">nxserver</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nxserver
├── nxserver.log
├── cpu1.log
├── cpu2.log
├── cpu3.log
├── settings.ini
├── nxsetup.sh
├── nxcommand.sh
└── task_list
    ├── info
    └── q00000
└── locks
    ├── ...
    └── ...
</pre></div>
</div>
<p><strong>nxserver.log</strong></p>
<blockquote>
<div><p>This is a log file that records jobs submitted to the server queue.</p>
</div></blockquote>
<p><strong>cpu1.log</strong>, <strong>cpu2.log</strong>, …</p>
<blockquote>
<div><p>These are log files that contain the output of jobs running on the
server. The number depends on the number of simultaneous jobs that
are allowed on the server, which is defined by the settings file.</p>
</div></blockquote>
<p><strong>settings.ini</strong></p>
<blockquote>
<div><p>A file containing default settings used by the <em>NXRefine</em> package,
including server parameters, instrumental parameters, and parameters
used in the data reduction workflow. When a new experiment is set up,
a copy of these parameters is stored in the experiment directory (to
be described later), so that they can be customized if necessary.
These settings are described below.</p>
</div></blockquote>
<p><strong>nxsetup.sh</strong></p>
<blockquote>
<div><p>A shell script that could be used to initialize paths to the server
directory or environment variables used by <em>NeXpy</em>. This could be run
within a user’s <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> file, or by other shell scripts used to
launch <em>NXRefine</em> workflow jobs (see below). Here is an example of
what this file could contain.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">NX_LOCKDIRECTORY</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">parent</span><span class="o">/</span><span class="n">nxserver</span><span class="o">/</span><span class="n">locks</span>
<span class="n">export</span> <span class="n">NX_LOCK</span><span class="o">=</span><span class="mi">10</span>
<span class="n">export</span> <span class="n">NX_SERVER</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">parent</span><span class="o">/</span><span class="n">nxserver</span>
</pre></div>
</div>
<p>Other commands, <em>e.g.</em>, to initialize a particular conda environment,
could be also be added to this file.</p>
</div></blockquote>
<p><strong>nxcommand.sh</strong></p>
<blockquote>
<div><p>A shell script that is used if jobs need to be wrapped before
submission to the job queue, <em>e.g.</em>, using <code class="docutils literal notranslate"><span class="pre">qsub</span></code>. Here is an
example, in which <code class="docutils literal notranslate"><span class="pre">nxsetup.sh</span></code> is run in order to initialize
<em>NXRefine</em>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo `date` &quot;USER ${USER} JOB_ID ${JOB_ID}&quot;
source /path/to/parent/nxserver/nxsetup.sh
&lt;NXSERVER&gt;
</pre></div>
</div>
</div></blockquote>
<p><strong>task_list</strong></p>
<blockquote>
<div><p>A directory that contains files that implement a file-based FIFO
queuing system for server jobs.</p>
</div></blockquote>
<p><strong>locks</strong></p>
<blockquote>
<div><p>A directory that contains files that implement the
<a class="reference external" href="https://nexpy.github.io/nexpy/">nexusformat</a> file-locking system.
Locked files can be viewed, and removed if they are stale, using the
“Show File Locks” dialog in the <em>NeXpy</em> “File” menu.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The log files can be viewed using the “Manage Server” dialog
and the settings file can be modified using the “Edit
Settings” dialog, both of which are located in the “Server”
menu in <em>NeXpy</em>.</p>
</div>
<div class="figure align-right" style="width: 50%">
<a class="reference internal image-reference" href="_images/server_settings.png"><img alt="_images/server_settings.png" src="_images/server_settings.png" style="width: 90%;" /></a>
</div>
</div>
<div class="section" id="default-settings">
<span id="id1"></span><h2>Default Settings<a class="headerlink" href="#default-settings" title="Permalink to this headline">¶</a></h2>
<p>The file, <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> in the server directory contains the default
settings for the server, the beamline, and the workflow. These values
can be changed, either by opening the “Edit Settings” dialog in the
<em>NeXpy</em> “Server” menu or at the command line using <code class="docutils literal notranslate"><span class="pre">nxsettings</span> <span class="pre">-i</span></code>,
which lists all the settings one by one, allowing their values to be
changed. Hitting the [Return] key keeps the current value.</p>
<p>The figure shows an example of the first two sections of
<code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>. The parameters in the first section are described
here. The other sections contain information concerning the location of
the data and default values of the data reduction parameters. They will
be described later.</p>
</div>
<div class="section" id="server-settings">
<h2>Server Settings<a class="headerlink" href="#server-settings" title="Permalink to this headline">¶</a></h2>
<p>The server settings are used by the workflow server, which is described
in a later section. They define the server configuration, such as the
number of simultaneous jobs that may be run, the command required to
add them to the system’s standard job queues, and whether they need to
be wrapped in a shell script.</p>
<dl class="field-list simple">
<dt class="field-odd">type</dt>
<dd class="field-odd"><p>The server type can either be <code class="docutils literal notranslate"><span class="pre">multicore</span></code> or <code class="docutils literal notranslate"><span class="pre">multinode</span></code>. The
only difference is that multinode servers have a list of defined
nodes, to which jobs may be submitted, so their names will also
be stored in the settings file. If jobs are submitted to a job
server, without needing to specify the node, or if all the jobs
are performed on the local machine, then the server type should
be <code class="docutils literal notranslate"><span class="pre">multicore</span></code>.</p>
</dd>
<dt class="field-even">cores</dt>
<dd class="field-even"><p>This sets the number of jobs that can be run simultaneously by
the server. Once reaching the limit, new jobs will only start as
old ones are finished.</p>
</dd>
<dt class="field-odd">concurrent</dt>
<dd class="field-odd"><p>This determines whether parallelized processes should be
used in the workflow. These speed up the computation, but
can be disabled if they cause issues with the server. Note
that this refers to whether multiple processes can be run
simultaneously, <em>e.g.</em>, in peaks searches, not whether
multiple jobs can be submitted to the server. Valid values
are <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
<dt class="field-even">run_command</dt>
<dd class="field-even"><p>This is a string that is prepended to any jobs that are
submitted to the server. It can contain a set of switches
in addition to the job submission command itself.</p>
</dd>
<dt class="field-odd">template</dt>
<dd class="field-odd"><p>In some systems, it is necessary to wrap the command that is
submitted to the server in a shell script. This is the name
of the script, which should be stored in the <code class="docutils literal notranslate"><span class="pre">nxserver</span></code>
directory. It should contain the string <code class="docutils literal notranslate"><span class="pre">&lt;NXSERVER&gt;</span></code>,
which is replaced by the job command.</p>
</dd>
<dt class="field-even">cctw</dt>
<dd class="field-even"><p>This is the path to the CCTW executable used to transform data
from instrumental coordinates to reciprocal space.</p>
</dd>
</dl>
</div>
<div class="section" id="server-menu">
<h2>Server Menu<a class="headerlink" href="#server-menu" title="Permalink to this headline">¶</a></h2>
<p>The <em>NXRefine</em> plugin to <em>NeXpy</em> installs a top-level menu labelled
“Server”, which is used to launch and monitor data reduction operations performed as part of the workflow.</p>
<div class="section" id="manage-workflows">
<h3>Manage Workflows<a class="headerlink" href="#manage-workflows" title="Permalink to this headline">¶</a></h3>
<p>This dialog shows the workflow status for all the scans stored in a
particular sample directory. When the dialog is launched, click on
“Choose Sample Directory” to launch the system file browser in order to
select a directory containing a set of NeXus scan files. This opens the
“Manage Workflows” dialog, in which the status of every component of the
<em>NXRefine</em> workflow is listed for all the scan files in the sample
directory.</p>
</div>
<div class="section" id="manage-server">
<h3>Manage Server<a class="headerlink" href="#manage-server" title="Permalink to this headline">¶</a></h3>
<p>This dialog allows the status of the server to be monitored.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Server Management</a><ul>
<li><a class="reference internal" href="#server-directory">Server Directory</a></li>
<li><a class="reference internal" href="#default-settings">Default Settings</a></li>
<li><a class="reference internal" href="#server-settings">Server Settings</a></li>
<li><a class="reference internal" href="#server-menu">Server Menu</a><ul>
<li><a class="reference internal" href="#manage-workflows">Manage Workflows</a></li>
<li><a class="reference internal" href="#manage-server">Manage Server</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="reduction.html"
                          title="previous chapter">Data Reduction</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="glossary.html"
                          title="next chapter">Glossary of Terms</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/server.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="glossary.html" title="Glossary of Terms"
             >next</a> |</li>
        <li class="right" >
          <a href="reduction.html" title="Data Reduction"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NXRefine 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Server Management</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Ray Osborn.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>